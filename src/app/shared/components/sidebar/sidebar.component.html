<div
  class="h-full flex flex-column shadow-3 border-right-2"
  style="
    width: 290px;
    background: var(--hms-surface);
    border-color: var(--hms-primary-light) !important;
  "
>
  <div class="p-4 flex align-items-center gap-3">
    <div
      class="border-round flex align-items-center justify-content-center shadow-2 overflow-hidden"
      style="
        width: 40px;
        height: 40px;
        background: var(--hms-primary);
        color: white;
      "
    >
      <img src="assets/logo.png" alt="HMS Logo" class="w-full h-full" />
    </div>
    <div class="flex flex-column">
      <span
        class="font-bold text-xl line-height-1"
        style="color: var(--hms-text)"
        >HMS</span
      >
      <span
        class="text-xs font-semibold uppercase tracking-wider"
        style="color: var(--hms-text-muted)"
        >Hospital Tech</span
      >
    </div>
  </div>

  <div class="flex-grow-1 overflow-y-auto px-3 py-2">
    <small
      class="font-bold block mb-2 ml-3"
      style="color: var(--hms-text-muted)"
      >MAIN MENU</small
    >

    <ul class="list-none p-0 m-0 flex flex-column gap-1">
      <ng-container *ngFor="let item of menuItems">
        <!-- Leaf Item -->
        <li *ngIf="!item.items">
          <a
            [routerLink]="item.route"
            routerLinkActive="active-link"
            class="nav-item flex align-items-center cursor-pointer p-3 border-round transition-duration-200 no-underline"
            [ngStyle]="
              isActive(item.route)
                ? {
                    background: 'var(--hms-primary-light)',
                    color: 'var(--hms-primary)',
                  }
                : { color: 'var(--hms-text-muted)' }
            "
          >
            <i
              class="pi pi-{{ item.icon }} mr-3 text-lg"
              [style.color]="
                isActive(item.route)
                  ? 'var(--hms-primary)'
                  : 'var(--hms-text-muted)'
              "
            ></i>
            <span class="font-semibold">{{ item.label }}</span>
            <span
              *ngIf="item.badge"
              class="ml-auto text-xs font-bold px-2 py-1 border-round"
              [style.background]="'var(--hms-primary-light)'"
              [style.color]="'var(--hms-primary)'"
            >
              {{ item.badge }}
            </span>
          </a>
        </li>

        <!-- Parent Item -->
        <li *ngIf="item.items">
          <div
            (click)="toggleMenu(item.label)"
            (keydown.enter)="toggleMenu(item.label)"
            tabindex="0"
            role="button"
            [attr.aria-expanded]="isExpanded(item.label)"
            class="flex align-items-center cursor-pointer p-3 border-round transition-duration-200 select-none hover:surface-100"
            [style.color]="'var(--hms-text-muted)'"
          >
            <i class="pi pi-{{ item.icon }} mr-3 text-lg"></i>
            <span class="font-semibold">{{ item.label }}</span>
            <i
              class="pi pi-chevron-down ml-auto transition-transform duration-200"
              [style.transform]="
                isExpanded(item.label) ? 'rotate(180deg)' : 'rotate(0deg)'
              "
            ></i>
          </div>

          <!-- Submenu -->
          <ul
            class="list-none p-0 m-0 overflow-hidden transition-all duration-300 ease-in-out"
            [style.max-height]="isExpanded(item.label) ? '1000px' : '0'"
            [style.opacity]="isExpanded(item.label) ? '1' : '0'"
          >
            <li *ngFor="let child of item.items" class="pl-3 mt-1">
              <a
                [routerLink]="child.route"
                routerLinkActive="active-link"
                class="nav-item flex align-items-center cursor-pointer p-3 border-round transition-duration-200 no-underline"
                [ngStyle]="
                  isActive(child.route)
                    ? {
                        background: 'var(--hms-primary-light)',
                        color: 'var(--hms-primary)',
                      }
                    : { color: 'var(--hms-text-muted)' }
                "
              >
                <!-- Smaller icon for children or same size? standard is slightly smaller or just indented (which pl-3 does) -->
                <i
                  class="pi pi-{{ child.icon }} mr-3 text-lg"
                  [style.color]="
                    isActive(child.route)
                      ? 'var(--hms-primary)'
                      : 'var(--hms-text-muted)'
                  "
                ></i>
                <span class="text-sm font-medium">{{ child.label }}</span>
              </a>
            </li>
          </ul>
        </li>
      </ng-container>
    </ul>
  </div>

  <div class="p-3">
    <div
      class="flex align-items-center gap-3 p-3 border-round-xl border-1"
      style="background: var(--hms-bg); border-color: var(--hms-primary-light)"
    >
      <p-avatar
        image="assets/demo/images/avatar.png"
        icon="pi pi-user"
        styleClass="shadow-1"
        [style]="{ background: 'var(--hms-primary)', color: 'white' }"
        shape="circle"
        size="large"
      ></p-avatar>

      <div class="flex flex-column">
        <span class="font-bold text-sm" style="color: var(--hms-text)"
          >User Profile</span
        >
        <span class="text-xs" style="color: var(--hms-text-muted)"
          >Logged In</span
        >
      </div>

      <button
        pButton
        icon="pi pi-power-off"
        class="p-button-rounded p-button-text p-button-sm ml-auto"
        style="color: var(--hms-error)"
        pTooltip="Sign Out"
        tooltipPosition="top"
        aria-label="Sign Out"
        (click)="onLogout()"
      ></button>
    </div>
  </div>
</div>
