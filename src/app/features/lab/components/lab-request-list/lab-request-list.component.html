<div class="card">
  <h2>Lab Requests</h2>
  <div class="flex justify-content-end mb-3">
    <!-- Filter or search could go here -->
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="text"
        (input)="dt.filterGlobal($any($event.target).value, 'contains')"
        placeholder="Search..."
      />
    </span>
  </div>

  <p-table
    #dt
    [value]="requests"
    [rows]="10"
    [paginator]="true"
    [globalFilterFields]="['patientName', 'testName', 'doctorName', 'id']"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="requestDate">
          Date <p-sortIcon field="requestDate"></p-sortIcon>
        </th>
        <th pSortableColumn="patientName">
          Patient <p-sortIcon field="patientName"></p-sortIcon>
        </th>
        <th pSortableColumn="testName">
          Test <p-sortIcon field="testName"></p-sortIcon>
        </th>
        <th pSortableColumn="doctorName">
          Doctor <p-sortIcon field="doctorName"></p-sortIcon>
        </th>
        <th pSortableColumn="priority">
          Priority <p-sortIcon field="priority"></p-sortIcon>
        </th>
        <th pSortableColumn="status">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-request>
      <tr>
        <td>{{ request.id }}</td>
        <td>{{ request.requestDate | date: "short" }}</td>
        <td>{{ request.patientName }}</td>
        <td>{{ request.testName }}</td>
        <td>{{ request.doctorName }}</td>
        <td>
          <p-tag
            [value]="request.priority"
            [severity]="getSeverity(request.priority)"
          ></p-tag>
        </td>
        <td>
          <p-tag
            [value]="request.status"
            [severity]="getStatusSeverity(request.status)"
          ></p-tag>
        </td>
        <td>
          <ng-container *appHasPermission="permissions.CMP_LAB_ENTRY">
            <button
              *ngIf="request.status !== 'COMPLETED'"
              pButton
              icon="pi pi-pencil"
              class="p-button-rounded p-button-success mr-2"
              (click)="enterResults(request.id)"
              pTooltip="Enter Results"
              tooltipPosition="top"
            ></button>
          </ng-container>
          <ng-container *appHasPermission="permissions.CMP_LAB_READ">
            <button
              *ngIf="request.status === 'COMPLETED'"
              pButton
              icon="pi pi-eye"
              class="p-button-rounded p-button-info"
              (click)="viewReport(request.id)"
              pTooltip="View Report"
              tooltipPosition="top"
            ></button>
          </ng-container>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8">No lab requests found.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
