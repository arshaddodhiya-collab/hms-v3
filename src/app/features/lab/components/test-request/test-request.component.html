<app-page-header
  title="Request Lab Test"
  subtitle="Order a new lab test for a patient"
  icon="flask"
></app-page-header>

<app-card styleClass="p-fluid">
  <div class="field grid">
    <label class="col-12 md:col-2">Patient</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="patients"
        [(ngModel)]="selectedPatient"
        optionLabel="name"
        [filter]="true"
        filterBy="name"
        placeholder="Select a Patient"
        [showClear]="true"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedPatient" class="p-error"
        >Patient is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Test Name</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="tests"
        [(ngModel)]="selectedTest"
        optionLabel="name"
        [filter]="true"
        filterBy="name"
        placeholder="Select a Test"
        [showClear]="true"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedTest" class="p-error"
        >Test is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Priority</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="priorities"
        [(ngModel)]="priority"
        placeholder="Select Priority"
      ></app-dropdown>
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Doctor</label>
    <div class="col-12 md:col-10">
      <app-input-text
        [(ngModel)]="doctorName"
        placeholder="Referring Doctor"
        [ngClass]="{ 'ng-invalid ng-dirty': submitted && !doctorName }"
      ></app-input-text>
      <small *ngIf="submitted && !doctorName" class="p-error"
        >Doctor name is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Notes</label>
    <div class="col-12 md:col-10">
      <textarea
        pInputTextarea
        [(ngModel)]="notes"
        rows="3"
        placeholder="Clinical Notes"
      ></textarea>
    </div>
  </div>

  <div class="flex justify-content-end gap-2 mt-4">
    <button
      pButton
      label="Cancel"
      class="p-button-secondary"
      aria-label="Cancel"
      (click)="cancel()"
    ></button>
    <button
      pButton
      label="Request Test"
      icon="pi pi-check"
      aria-label="Request Test"
      (click)="save()"
      [loading]="loading"
    ></button>
  </div>
</app-card>
