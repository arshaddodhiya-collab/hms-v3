<div class="grid p-fluid fadein animation-duration-400">
  <ng-container *ngIf="stats$ | async as stats">
    <div class="col-12 md:col-6 lg:col-3">
      <div
        class="stats-card surface-card shadow-1 p-4 border-round-xl border-1 border-gray-100 hover:shadow-3 transition-all cursor-pointer"
      >
        <div class="flex justify-content-between mb-3">
          <div>
            <span
              class="block text-500 font-semibold mb-2 uppercase text-xs tracking-wider"
              >Total Patients</span
            >
            <div class="text-900 font-bold text-3xl">
              {{ stats.totalPatients | number }}
            </div>
          </div>
          <div
            class="flex align-items-center justify-content-center bg-indigo-50 border-round-lg"
            style="width: 3.5rem; height: 3.5rem"
          >
            <i class="pi pi-users text-indigo-500 text-2xl"></i>
          </div>
        </div>
        <div class="flex align-items-center gap-2">
          <span
            class="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 border-round"
          >
            <i class="pi pi-arrow-up text-xs mr-1"></i>24
          </span>
          <span class="text-500 text-sm">since last visit</span>
        </div>
      </div>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <div
        class="stats-card surface-card shadow-1 p-4 border-round-xl border-1 border-gray-100 hover:shadow-3 transition-all cursor-pointer"
      >
        <div class="flex justify-content-between mb-3">
          <div>
            <span
              class="block text-500 font-semibold mb-2 uppercase text-xs tracking-wider"
              >Appointments</span
            >
            <div class="text-900 font-bold text-3xl">
              {{ stats.todayAppointments }}
            </div>
          </div>
          <div
            class="flex align-items-center justify-content-center bg-orange-50 border-round-lg"
            style="width: 3.5rem; height: 3.5rem"
          >
            <i class="pi pi-calendar text-orange-500 text-2xl"></i>
          </div>
        </div>
        <div class="flex align-items-center gap-2">
          <span
            class="bg-orange-100 text-orange-700 text-xs font-bold px-2 py-1 border-round"
          >
            +52%
          </span>
          <span class="text-500 text-sm">vs last week</span>
        </div>
      </div>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <div
        class="stats-card surface-card shadow-1 p-4 border-round-xl border-1 border-gray-100 hover:shadow-3 transition-all cursor-pointer"
      >
        <div class="flex justify-content-between mb-3">
          <div>
            <span
              class="block text-500 font-semibold mb-2 uppercase text-xs tracking-wider"
              >Active Staff</span
            >
            <div class="text-900 font-bold text-3xl">
              {{ stats.totalDoctors }}
            </div>
          </div>
          <div
            class="flex align-items-center justify-content-center bg-teal-50 border-round-lg"
            style="width: 3.5rem; height: 3.5rem"
          >
            <i class="pi pi-briefcase text-teal-500 text-2xl"></i>
          </div>
        </div>
        <div class="flex align-items-center gap-2">
          <span
            class="w-1rem h-1rem bg-green-500 border-circle border-2 border-white shadow-1"
          ></span>
          <span class="text-500 text-sm font-medium">14 On-duty now</span>
        </div>
      </div>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <div
        class="stats-card surface-card shadow-1 p-4 border-round-xl border-1 border-gray-100 hover:shadow-3 transition-all cursor-pointer"
      >
        <div class="flex justify-content-between mb-3">
          <div>
            <span
              class="block text-500 font-semibold mb-2 uppercase text-xs tracking-wider"
              >Revenue Risk</span
            >
            <div class="text-900 font-bold text-3xl">
              {{ stats.pendingBills }}
            </div>
          </div>
          <div
            class="flex align-items-center justify-content-center bg-pink-50 border-round-lg"
            style="width: 3.5rem; height: 3.5rem"
          >
            <i class="pi pi-wallet text-pink-500 text-2xl"></i>
          </div>
        </div>
        <div class="flex align-items-center gap-2">
          <span class="text-pink-600 font-bold text-sm">12 overdue</span>
          <span class="text-500 text-sm">â€¢ Action required</span>
        </div>
      </div>
    </div>
  </ng-container>

  <div class="col-12 lg:col-7 mt-3">
    <div
      class="surface-card shadow-1 border-round-xl border-1 border-gray-100 p-0 overflow-hidden h-full"
    >
      <div
        class="flex align-items-center justify-content-between p-4 bg-gray-50 border-bottom-1 border-gray-100"
      >
        <div class="flex flex-column">
          <span class="text-xl font-bold text-900">Medical Directory</span>
          <span class="text-sm text-500"
            >Live availability of specialized staff</span
          >
        </div>
        <button
          pButton
          icon="pi pi-filter"
          class="p-button-outlined p-button-sm p-button-secondary border-round-lg"
        ></button>
      </div>

      <p-table
        [value]="(doctors$ | async) || []"
        [rows]="5"
        responsiveLayout="scroll"
        styleClass="p-datatable-sm custom-table"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="bg-white text-500 font-semibold">Doctor</th>
            <th class="bg-white text-500 font-semibold">Department</th>
            <th class="bg-white text-500 font-semibold">Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-doctor>
          <tr class="hover:bg-gray-50 transition-colors">
            <td>
              <div class="flex align-items-center gap-3">
                <p-avatar
                  [label]="doctor.name.charAt(0)"
                  shape="circle"
                  class="shadow-1"
                ></p-avatar>
                <span class="font-bold text-800">{{ doctor.name }}</span>
              </div>
            </td>
            <td>
              <span class="text-600">{{ doctor.specialization }}</span>
            </td>
            <td>
              <span
                [class]="
                  doctor.availability === 'Available'
                    ? 'status-pill-available'
                    : 'status-pill-busy'
                "
              >
                {{ doctor.availability }}
              </span>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <div class="col-12 lg:col-5 mt-3">
    <div
      class="surface-card shadow-1 border-round-xl border-1 border-gray-100 p-4 h-full"
    >
      <div class="flex align-items-center justify-content-between mb-4">
        <span class="text-xl font-bold text-900">System Logs</span>
        <button
          pButton
          label="History"
          icon="pi pi-external-link"
          class="p-button-text p-button-sm font-bold"
        ></button>
      </div>

      <div class="activity-timeline">
        <div
          class="flex align-items-start mb-4 relative"
          *ngFor="let activity of recentActivities$ | async; let last = last"
        >
          <div
            *ngIf="!last"
            class="absolute left-2 top-4 h-full border-left-1 border-200"
            style="margin-left: 0.45rem"
          ></div>

          <div
            class="z-1 w-2rem h-2rem flex align-items-center justify-content-center border-circle mr-3 flex-shrink-0 shadow-1"
            [ngClass]="{
              'bg-blue-500 text-white': activity.type === 'info',
              'bg-green-500 text-white': activity.type === 'success',
              'bg-orange-500 text-white': activity.type === 'warning',
              'bg-red-500 text-white': activity.type === 'error',
            }"
          >
            <i
              class="pi text-xs"
              [ngClass]="{
                'pi-info': activity.type === 'info',
                'pi-check': activity.type === 'success',
                'pi-exclamation-triangle': activity.type === 'warning',
                'pi-times': activity.type === 'error',
              }"
            ></i>
          </div>

          <div class="flex-column flex flex-grow-1">
            <div class="flex justify-content-between align-items-center mb-1">
              <span class="text-900 font-semibold text-sm">{{
                activity.message
              }}</span>
              <span class="text-400 text-xs font-medium">{{
                activity.time
              }}</span>
            </div>
            <div class="flex align-items-center gap-2">
              <span class="text-500 text-xs">Performed by</span>
              <span class="text-indigo-600 text-xs font-bold">{{
                activity.user
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
