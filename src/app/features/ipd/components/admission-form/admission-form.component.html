<app-page-header
  title="New Admission"
  subtitle="Admit a patient to IPD"
  icon="user-plus"
></app-page-header>

<app-card styleClass="p-fluid">
  <div class="field grid">
    <label class="col-12 md:col-2">Patient</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="facade.patients()"
        [(ngModel)]="selectedPatient"
        optionLabel="name"
        [optionValue]="null"
        [filter]="true"
        filterBy="name"
        placeholder="Select a Patient"
        [showClear]="true"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedPatient" class="p-error"
        >Patient is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Ward</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="facade.wards()"
        [(ngModel)]="selectedWard"
        placeholder="Select Ward"
        (onChange)="onWardChange()"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedWard" class="p-error"
        >Ward is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Bed</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="facade.availableBeds()"
        [(ngModel)]="selectedBed"
        optionLabel="number"
        [optionValue]="null"
        placeholder="Select Bed"
        [disabled]="!selectedWard"
        emptyMessage="No available beds in this ward"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedBed" class="p-error"
        >Bed is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Doctor</label>
    <div class="col-12 md:col-10">
      <app-dropdown
        [options]="facade.doctors()"
        [(ngModel)]="selectedDoctor"
        optionLabel="fullName"
        [optionValue]="null"
        [filter]="true"
        filterBy="fullName"
        placeholder="Select Attending Doctor"
      ></app-dropdown>
      <small *ngIf="submitted && !selectedDoctor" class="p-error"
        >Doctor is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Diagnosis</label>
    <div class="col-12 md:col-10">
      <textarea
        pInputTextarea
        [(ngModel)]="diagnosis"
        rows="3"
        placeholder="Initial Diagnosis"
      ></textarea>
      <small *ngIf="submitted && !diagnosis" class="p-error"
        >Diagnosis is required.</small
      >
    </div>
  </div>

  <div class="flex justify-content-end gap-2 mt-4">
    <button
      pButton
      label="Cancel"
      class="p-button-secondary"
      (click)="cancel()"
    ></button>
    <button
      pButton
      label="Admit Patient"
      icon="pi pi-check"
      (click)="save()"
      [loading]="facade.saving()"
    ></button>
  </div>
</app-card>
