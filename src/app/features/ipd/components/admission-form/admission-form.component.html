<app-page-header
  title="New Admission"
  subtitle="Admit a patient to IPD"
  icon="user-plus"
></app-page-header>

<div class="card p-fluid">
  <div class="field grid">
    <label class="col-12 md:col-2">Patient</label>
    <div class="col-12 md:col-10">
      <p-dropdown
        [options]="patients"
        [(ngModel)]="selectedPatient"
        optionLabel="name"
        [filter]="true"
        filterBy="name"
        placeholder="Select a Patient"
        [showClear]="true"
        [ngClass]="{ 'ng-invalid ng-dirty': submitted && !selectedPatient }"
      ></p-dropdown>
      <small *ngIf="submitted && !selectedPatient" class="p-error"
        >Patient is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Ward</label>
    <div class="col-12 md:col-10">
      <p-dropdown
        [options]="wards"
        [(ngModel)]="selectedWard"
        placeholder="Select Ward"
        (onChange)="onWardChange()"
        [ngClass]="{ 'ng-invalid ng-dirty': submitted && !selectedWard }"
      ></p-dropdown>
      <small *ngIf="submitted && !selectedWard" class="p-error"
        >Ward is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Bed</label>
    <div class="col-12 md:col-10">
      <p-dropdown
        [options]="availableBeds"
        [(ngModel)]="selectedBed"
        optionLabel="number"
        placeholder="Select Bed"
        [disabled]="!selectedWard"
        emptyMessage="No available beds in this ward"
        [ngClass]="{ 'ng-invalid ng-dirty': submitted && !selectedBed }"
      ></p-dropdown>
      <small *ngIf="submitted && !selectedBed" class="p-error"
        >Bed is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Doctor</label>
    <div class="col-12 md:col-10">
      <input
        pInputText
        [(ngModel)]="admission.doctorName"
        placeholder="Attending Doctor"
        [ngClass]="{
          'ng-invalid ng-dirty': submitted && !admission.doctorName,
        }"
      />
      <small *ngIf="submitted && !admission.doctorName" class="p-error"
        >Doctor name is required.</small
      >
    </div>
  </div>

  <div class="field grid">
    <label class="col-12 md:col-2">Diagnosis</label>
    <div class="col-12 md:col-10">
      <textarea
        pInputTextarea
        [(ngModel)]="admission.diagnosis"
        rows="3"
        placeholder="Initial Diagnosis"
      ></textarea>
    </div>
  </div>

  <div class="flex justify-content-end gap-2 mt-4">
    <button
      pButton
      label="Cancel"
      class="p-button-secondary"
      (click)="cancel()"
    ></button>
    <button
      pButton
      label="Admit Patient"
      icon="pi pi-check"
      (click)="save()"
      [loading]="loading"
    ></button>
  </div>
</div>
