<app-card>
  <app-page-header
    title="Consultation Queue"
    icon="pi pi-user-md"
  ></app-page-header>

  <p-tabView>
    <p-tabPanel header="OPD (Appt)">
      <app-table
        [data]="facade.doctorQueue()"
        [columns]="cols"
        [actionsTemplate]="actions"
        [loading]="facade.loading()"
      >
      </app-table>
    </p-tabPanel>
  </p-tabView>
</app-card>

<!-- Reusing 'patientTemplate' name from TS, but let's use it for the composite Age/Gender mostly, or define distinct ones. -->
<!-- In TS I mapped 'age' field to 'patientTemplate' (renaming in mind). Let's fix TS mapping via Logic or just bind correctly. -->
<!-- I'll rename the ViewChild in TS in next step if needed, or just use #ageTemplate here and ensure TS finds it. -->
<!-- Actually, 'patientName' needs bold. 'age' needs composite. -->

<ng-template #patientNameTemplate let-value>
  <span class="font-bold">{{ value }}</span>
</ng-template>

<ng-template #ageTemplate let-value let-row="row">
  {{ value }} / {{ row.gender }}
</ng-template>

<ng-template #priorityTemplate let-value>
  <app-status-badge
    [status]="value"
    [type]="
      value === 'Emergency' ? 'danger' : value === 'High' ? 'warning' : 'info'
    "
  >
  </app-status-badge>
</ng-template>

<ng-template #statusTemplate let-value>
  <app-status-badge
    [status]="
      value === 'TRIAGE'
        ? 'Waiting'
        : value === 'IN_PROGRESS'
          ? 'In Progress'
          : value
    "
    [type]="
      value === 'TRIAGE'
        ? 'warning'
        : value === 'IN_PROGRESS'
          ? 'success'
          : 'info'
    "
  >
  </app-status-badge>
</ng-template>

<ng-template #actions let-item>
  <button
    *appHasPermission="permissions.CMP_CONSULTATION_WRITE"
    pButton
    pRipple
    label="Consult"
    icon="pi pi-check"
    class="p-button-sm"
    [routerLink]="[item.id]"
  ></button>
</ng-template>
