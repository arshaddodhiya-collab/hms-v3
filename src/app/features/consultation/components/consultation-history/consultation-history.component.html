<div *ngIf="encounters.length === 0" class="text-center p-5 text-500">
  <i class="pi pi-file-medical text-4xl mb-3"></i>
  <p>No consultation history yet.</p>
</div>
<div
  *ngFor="let encounter of encounters"
  class="mb-4 surface-ground p-4 border-round"
>
  <div class="flex justify-content-between mb-3">
    <div>
      <span class="font-bold text-lg">{{
        encounter.startedAt | date: 'medium'
      }}</span>
      <p-tag
        [value]="encounter.status"
        [severity]="getSeverity(encounter.status)"
        styleClass="ml-2"
      ></p-tag>
      <p-tag
        *ngIf="encounter.admissionId"
        value="IPD"
        severity="warning"
        styleClass="ml-2"
      ></p-tag>
      <p-tag
        *ngIf="encounter.appointmentId"
        value="OPD"
        severity="info"
        styleClass="ml-2"
      ></p-tag>
    </div>
    <span class="text-600">{{ encounter.doctorName }}</span>
  </div>

  <div *ngIf="encounter.chiefComplaint" class="mb-2">
    <strong>Chief Complaint:</strong> {{ encounter.chiefComplaint }}
  </div>

  <div *ngIf="encounter.diagnosis" class="mb-2">
    <strong>Diagnosis:</strong> {{ encounter.diagnosis }}
  </div>

  <div *ngIf="encounter.notes" class="mb-2">
    <strong>Notes:</strong> {{ encounter.notes }}
  </div>

  <!-- Rounds History -->
  <div
    *ngIf="encounter.rounds && encounter.rounds.length > 0"
    class="mt-3 surface-100 p-3 border-round"
  >
    <h4 class="text-sm font-bold mb-2">Rounds History</h4>
    <div
      *ngFor="let round of encounter.rounds"
      class="mb-2 border-bottom-1 surface-border pb-2"
    >
      <div class="flex justify-content-between text-sm">
        <span class="font-medium">{{ round.createdAt | date: 'short' }}</span>
        <span class="text-600">{{ round.doctorName }}</span>
      </div>
      <div class="text-sm mt-1">
        {{ round.notes }}
      </div>
    </div>
  </div>

  <!-- Vitals History -->
  <div
    *ngIf="encounter.vitalsHistory && encounter.vitalsHistory.length > 0"
    class="mt-3 surface-100 p-3 border-round"
  >
    <h4 class="text-sm font-bold mb-2">Vitals History</h4>
    <p-table
      [value]="encounter.vitalsHistory"
      styleClass="p-datatable-sm text-sm"
      [rowHover]="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Time</th>
          <th>BP</th>
          <th>Pulse</th>
          <th>Temp</th>
          <th>SpO2</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-v>
        <tr>
          <td>
            {{ v.recordedAt | date: 'shortTime' }} <br />
            <small>{{ v.recordedAt | date: 'shortDate' }}</small>
          </td>
          <td>{{ v.systolic }}/{{ v.diastolic }}</td>
          <td>{{ v.pulse }}</td>
          <td>{{ v.temperature }}</td>
          <td>{{ v.spo2 }}%</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
