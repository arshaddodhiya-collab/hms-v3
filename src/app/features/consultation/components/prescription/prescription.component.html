<app-card header="Prescription">
  <!-- Add Medicine Form -->
  <div class="p-fluid grid formgrid mb-4">
    <div class="field col-12 md:col-4">
      <app-input-text
        label="Medicine Name *"
        [(ngModel)]="newMed.medicineName"
        placeholder="Paracetamol"
        [ngClass]="{
          'ng-invalid ng-dirty': submitted && !newMed.medicineName.trim(),
        }"
      ></app-input-text>
      <small class="p-error" *ngIf="submitted && !newMed.medicineName.trim()"
        >Medicine name is required.</small
      >
    </div>
    <div class="field col-12 md:col-3">
      <app-input-text
        label="Dosage *"
        [(ngModel)]="newMed.dosage"
        placeholder="500mg"
        [ngClass]="{
          'ng-invalid ng-dirty': submitted && !newMed.dosage.trim(),
        }"
      ></app-input-text>
      <small class="p-error" *ngIf="submitted && !newMed.dosage.trim()"
        >Dosage is required.</small
      >
    </div>
    <div class="field col-12 md:col-3">
      <label>Frequency <span class="text-red-500">*</span></label>
      <app-dropdown
        [options]="frequencies"
        [(ngModel)]="newMed.frequency"
        placeholder="Select"
        appendTo="body"
        [ngClass]="{ 'ng-invalid ng-dirty': submitted && !newMed.frequency }"
      ></app-dropdown>
      <small class="p-error" *ngIf="submitted && !newMed.frequency"
        >Frequency is required.</small
      >
    </div>
    <div class="field col-12 md:col-2">
      <app-input-text
        label="Duration"
        [(ngModel)]="newMed.duration"
        placeholder="5 days"
      ></app-input-text>
    </div>
    <div class="col-12 flex justify-content-end">
      <button
        pButton
        label="Add"
        icon="pi pi-plus"
        (click)="addMedicine()"
        class="p-button-outlined w-auto"
      ></button>
    </div>
  </div>

  <div class="flex justify-content-end mt-4">
    <button
      pButton
      label="Save Prescription"
      icon="pi pi-save"
      (click)="savePrescription()"
      [disabled]="medicines.length === 0"
    ></button>
  </div>

  <!-- Medicines Table -->
  <p-table
    [value]="medicines"
    styleClass="p-datatable-sm"
    *ngIf="medicines.length > 0"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Medicine</th>
        <th>Dosage</th>
        <th>Frequency</th>
        <th>Duration</th>
        <th style="width: 4rem"></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-med let-i="rowIndex">
      <tr>
        <td>{{ med.medicineName }}</td>
        <td>{{ med.dosage }}</td>
        <td>{{ med.frequency }}</td>
        <td>{{ med.duration }}</td>
        <td>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-text p-button-danger p-button-sm"
            (click)="removeMedicine(i)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</app-card>
