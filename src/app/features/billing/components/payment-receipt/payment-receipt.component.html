<app-card *ngIf="invoice">
  <div
    class="flex justify-content-between align-items-center mb-4 print-hidden"
  >
    <button
      pButton
      icon="pi pi-arrow-left"
      label="Back"
      class="p-button-text"
      (click)="goBack()"
    ></button>
    <button
      pButton
      icon="pi pi-print"
      label="Print Receipt"
      class="p-button-outlined"
      (click)="print()"
    ></button>
  </div>

  <div class="receipt-container p-5 border-1 border-300 border-round surface-0">
    <div class="text-center mb-6 border-bottom-1 border-300 pb-4">
      <h1 class="m-0 text-primary text-4xl mb-2">PAYMENT RECEIPT</h1>
      <div class="text-600 font-medium">Hospital Management System</div>
      <div class="text-500">123 Health City, Medical District</div>
    </div>

    <div class="grid mb-5">
      <div class="col-6">
        <div class="text-500 text-sm mb-1">Billed To</div>
        <div class="font-bold text-xl mb-1">{{ invoice.patientName }}</div>
        <div class="text-600">ID: {{ invoice.patientId }}</div>
      </div>
      <div class="col-6 text-right">
        <div class="text-500 text-sm mb-1">Invoice #</div>
        <div class="font-bold text-xl mb-1">{{ invoice.invoiceNumber }}</div>
        <div class="text-500 text-sm mb-1">Date</div>
        <div class="text-900">
          {{ invoice.issueDate | date: 'mediumDate' }}
        </div>
        <div class="mt-2">
          <app-status-badge [status]="invoice.status"></app-status-badge>
        </div>
      </div>
    </div>

    <div class="mb-5">
      <p-table
        [value]="invoice.items"
        styleClass="p-datatable-sm p-datatable-gridlines"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 70%">Description</th>
            <th style="width: 30%" class="text-right">Amount</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{ item.itemDescription }}</td>
            <td class="text-right">{{ item.totalPrice | currency }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div class="grid justify-content-end mb-6">
      <div class="col-6 md:col-4">
        <div class="flex justify-content-between mb-2">
          <span class="text-600">Subtotal:</span>
          <span class="font-bold">{{ invoice.totalAmount | currency }}</span>
        </div>
        <div class="flex justify-content-between mb-2">
          <span class="text-600">Discount:</span>
          <span class="font-bold text-green-600"
            >-{{ invoice.discountAmount | currency }}</span
          >
        </div>
        <div
          class="flex justify-content-between mb-2 pb-2 border-bottom-1 border-300"
        >
          <span class="text-600">Tax:</span>
          <span class="font-bold">{{ invoice.taxAmount | currency }}</span>
        </div>
        <div class="flex justify-content-between text-xl mb-2">
          <span class="font-bold text-900">Total:</span>
          <span class="font-bold text-primary">{{
            invoice.netAmount | currency
          }}</span>
        </div>
        <div class="flex justify-content-between mb-2">
          <span class="text-600">Paid:</span>
          <span class="font-bold text-green-600">{{
            invoice.paidAmount | currency
          }}</span>
        </div>
        <div class="flex justify-content-between mb-2">
          <span class="text-600">Due:</span>
          <span class="font-bold text-red-600">{{
            invoice.dueAmount | currency
          }}</span>
        </div>
      </div>
    </div>

    <!-- Payment Section -->
    <div
      *ngIf="
        invoice.status === InvoiceStatus.ISSUED ||
        invoice.status === InvoiceStatus.PARTIALLY_PAID
      "
      class="surface-ground p-4 border-round mb-4 print-hidden"
    >
      <h3 class="mt-0 mb-3">Record Payment</h3>
      <div class="grid align-items-end">
        <div class="col-12 md:col-4">
          <label class="block mb-2">Amount</label>
          <p-inputNumber
            [(ngModel)]="paymentAmount"
            mode="currency"
            currency="USD"
            locale="en-US"
            [max]="invoice.dueAmount"
          ></p-inputNumber>
        </div>
        <div class="col-12 md:col-4">
          <label class="block mb-2">Payment Method</label>
          <p-dropdown
            [options]="paymentMethods"
            [(ngModel)]="paymentMethod"
          ></p-dropdown>
        </div>
        <div class="col-12 md:col-4">
          <button
            pButton
            label="Process Payment"
            icon="pi pi-check"
            (click)="makePayment()"
          ></button>
        </div>
      </div>
    </div>

    <!-- Payment History -->
    <div *ngIf="invoice.payments && invoice.payments.length > 0" class="mb-4">
      <h3 class="mb-3">Payment History</h3>
      <p-table [value]="invoice.payments" styleClass="p-datatable-sm">
        <ng-template pTemplate="header">
          <tr>
            <th>Date</th>
            <th>Reference</th>
            <th>Method</th>
            <th class="text-right">Amount</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-payment>
          <tr>
            <td>{{ payment.paymentDate | date: 'medium' }}</td>
            <td>{{ payment.transactionReference }}</td>
            <td>{{ payment.paymentMethod }}</td>
            <td class="text-right">{{ payment.amount | currency }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div class="text-center text-500 text-sm mt-6 pt-4 border-top-1 border-200">
      Thank you for your visit. Get well soon!
    </div>
  </div>
</app-card>
