<app-page-header
  title="Appointment Details"
  subtitle="View appointment information and history"
  icon="pi pi-calendar"
  [showBack]="true"
>
  <button
    pButton
    label="Reschedule"
    icon="pi pi-calendar-plus"
    class="p-button-outlined mr-2"
  ></button>
  <button
    pButton
    label="Cancel"
    icon="pi pi-times"
    class="p-button-danger p-button-outlined"
  ></button>
</app-page-header>

<div class="grid" *ngIf="facade.selectedAppointment() as appointment">
  <!-- Left Column: Context (Patient & Doctor) -->
  <div class="col-12 md:col-3">
    <app-card header="Patient" styleClass="mb-3">
      <div class="flex align-items-center gap-3 mb-2">
        <p-avatar
          icon="pi pi-user"
          size="large"
          shape="circle"
          styleClass="bg-primary-100 text-primary"
        ></p-avatar>
        <div>
          <div class="font-bold text-900">{{ appointment.patientName }}</div>
          <div class="text-500 text-sm">
            Patient ID: #P-{{ appointment.patientId }}
          </div>
        </div>
      </div>
      <button
        pButton
        label="View Profile"
        class="p-button-text p-button-sm w-full"
        routerLink="/patients/{{ appointment.patientId }}"
      ></button>
    </app-card>

    <app-card header="Doctor">
      <div class="flex align-items-center gap-3 mb-2">
        <p-avatar
          icon="pi pi-briefcase"
          size="large"
          shape="circle"
          styleClass="bg-orange-100 text-orange-500"
        ></p-avatar>
        <div>
          <div class="font-bold text-900">{{ appointment.doctorName }}</div>
          <div class="text-500 text-sm">Specialist</div>
        </div>
      </div>
      <button
        pButton
        label="View Schedule"
        class="p-button-text p-button-sm w-full"
      ></button>
    </app-card>
  </div>

  <!-- Center Column: Appointment Details -->
  <div class="col-12 md:col-6">
    <app-card header="Appointment Info" subheader="General Information">
      <div class="grid">
        <div class="col-6 mb-3">
          <div class="text-500 mb-1">Date</div>
          <div class="font-medium text-900 flex align-items-center gap-2">
            <i class="pi pi-calendar text-primary"></i>
            {{ appointment.startDateTime | date: 'fullDate' }}
          </div>
        </div>
        <div class="col-6 mb-3">
          <div class="text-500 mb-1">Time</div>
          <div class="font-medium text-900 flex align-items-center gap-2">
            <i class="pi pi-clock text-primary"></i>
            {{ appointment.startDateTime | date: 'shortTime' }}
          </div>
        </div>
        <div class="col-6 mb-3">
          <div class="text-500 mb-1">Type</div>
          <div class="font-medium text-900">{{ appointment.type }}</div>
        </div>
        <div class="col-6 mb-3">
          <div class="text-500 mb-1">Location</div>
          <div class="font-medium text-900">Room -</div>
        </div>
        <div class="col-12 mb-3">
          <div class="text-500 mb-1">Status</div>
          <p-tag
            [value]="appointment.status"
            [severity]="getSeverity(appointment.status)"
          ></p-tag>
        </div>
      </div>

      <p-divider></p-divider>

      <div class="mb-4">
        <h4 class="text-900 font-medium mb-2">Reason for Visit</h4>
        <p class="m-0 line-height-3 text-700">{{ appointment.reason }}</p>
      </div>
    </app-card>
  </div>
</div>

<!-- Loading State -->
<div
  *ngIf="!facade.selectedAppointment() && facade.loading()"
  class="flex align-items-center justify-content-center p-5"
>
  <i class="pi pi-spin pi-spinner text-4xl text-500"></i>
</div>
